<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Bounce Prototype</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #222;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    canvas {
        background: #111;
        border: 3px solid #fff;
    }
</style>
</head>
<body>
<canvas id="game" width="400" height="700"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const player = { x: 180, y: 600, w: 40, h: 40, color: 'yellow', vy: 0 };
const gravity = 0.5;
const portals = { blue: null, orange: null };
const keys = {};

const platforms = [
    { x: 50, y: 650, w: 300, h: 20 },
    { x: 100, y: 500, w: 200, h: 20 },
    { x: 50, y: 350, w: 300, h: 20 },
];

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    if (!portals.blue) portals.blue = { x: mx, y: my };
    else if (!portals.orange) portals.orange = { x: mx, y: my };
    else {
        portals.blue = { ...portals.orange };
        portals.orange = { x: mx, y: my };
    }
});

function update() {
    // Gravité
    player.vy += gravity;
    player.y += player.vy;

    // Collision plateformes
    platforms.forEach(p => {
        if (player.x < p.x + p.w && player.x + player.w > p.x &&
            player.y + player.h < p.y + p.h && player.y + player.h > p.y &&
            player.vy > 0) {
            player.y = p.y - player.h;
            player.vy = 0;
        }
    });

    // Déplacement horizontal
    if (keys['ArrowLeft']) player.x -= 5;
    if (keys['ArrowRight']) player.x += 5;

    // Collision avec portails
    for (let color in portals) {
        const portal = portals[color];
        if (portal &&
            player.x < portal.x + 40 && player.x + player.w > portal.x &&
            player.y < portal.y + 40 && player.y + player.h > portal.y) {
            const other = color === 'blue' ? portals.orange : portals.blue;
            if (other) {
                player.x = other.x;
                player.y = other.y;
            }
        }
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Plateformes
    ctx.fillStyle = 'white';
    platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

    // Portails
    if (portals.blue) { ctx.fillStyle = 'blue'; ctx.fillRect(portals.blue.x, portals.blue.y, 40, 40); }
    if (portals.orange) { ctx.fillStyle = 'orange'; ctx.fillRect(portals.orange.x, portals.orange.y, 40, 40); }

    // Joueur
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
